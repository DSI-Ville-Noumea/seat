<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.3.xsd http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">



<!-- <changeSet author="boulu72" id="createFunction_MAIRIE_DATE_SQL_TO_400"> -->
<!--     <createProcedure  -->
<!--             dbms="postgres" -->
<!--             encoding="utf8" -->
<!--             procedureName="MAIRIE_DATE_SQL_TO_400" -->
<!--             relativeToChangelogFile="true"> -->
<!--             CREATE OR REPLACE FUNCTION MAIRIE_DATE_SQL_TO_400 (DATE) RETURNS integer -->
<!-- AS 'select cast(EXTRACT (YEAR FROM $1) * 10000 + EXTRACT (MONTH FROM $1) * 100 + EXTRACT (DAY FROM $1 ) as integer); ' -->
<!-- LANGUAGE SQL -->
<!-- IMMUTABLE -->
<!-- RETURNS NULL ON NULL INPUT; -->
<!-- </createProcedure> -->
<!-- </changeSet> -->


	<changeSet author="boulu72" id="reateFunction_MAIRIE_DATE_SQL_TO_400" >
		<sql dbms="postgresql"
	          stripComments="true">
				CREATE OR REPLACE FUNCTION MAIRIE_DATE_SQL_TO_400 (DATE) RETURNS integer
	AS 'select cast(EXTRACT (YEAR FROM $1) * 10000 + EXTRACT (MONTH FROM $1) * 100 + EXTRACT (DAY FROM $1 ) as integer); '
	LANGUAGE SQL
	IMMUTABLE
	RETURNS NULL ON NULL INPUT;
	        <comment>Fonction qui convertit une date au format SQL en yyyymmdd</comment>
	    </sql>
	    <rollback>
	    	<sql dbms="postgresql"
	          stripComments="true">
				DROP FUNCTION MAIRIE_DATE_SQL_TO_400 (DATE);
	    </sql>
	    </rollback>
	   
	</changeSet>


</databaseChangeLog>
